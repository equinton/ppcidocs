<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>model – PPCI - PrototypePHP for CodeIgniter</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-c2162276683bab39c8a89f64fc3c08ec.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Pas de résultats",
    "search-matching-documents-text": "documents trouvés",
    "search-copy-link-title": "Copier le lien vers la recherche",
    "search-hide-matches-text": "Cacher les correspondances additionnelles",
    "search-more-match-text": "correspondance de plus dans ce document",
    "search-more-matches-text": "correspondances de plus dans ce document",
    "search-clear-button-title": "Effacer",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Annuler",
    "search-submit-button-title": "Envoyer",
    "search-label": "Recherche"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="site_libs/quarto-contrib/quarto-project/SebastienBoutry/inrae-project-website/ressources/styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./images/ci-logo.png" alt="" class="navbar-logo light-content">
    <img src="./images/ci-logo.png" alt="" class="navbar-logo dark-content">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">PPCI - PrototypePHP for CodeIgniter</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Recherche"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Basculer la navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> <i class="bi bi-house-door-fill" role="img">
</i> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-installation" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">installation</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-installation">    
        <li>
    <a class="dropdown-item" href="./installation.html">
 <span class="dropdown-text">installation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./migration.html">
 <span class="dropdown-text">migration depuis PrototypePhp</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./multi-instance.html">
 <span class="dropdown-text">multi-instances</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-documentation-technique" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">documentation technique</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-documentation-technique">    
        <li>
    <a class="dropdown-item" href="./principes.html">
 <span class="dropdown-text">Principes généraux</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./parameters.html">
 <span class="dropdown-text">Paramétrage</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./identification.html">
 <span class="dropdown-text">Identification</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./rights.html">
 <span class="dropdown-text">Gestion des droits</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./controllers.html">
 <span class="dropdown-text">Routes et contrôleurs</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./libraries.html">
 <span class="dropdown-text">Librairies</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./views.html">
 <span class="dropdown-text">Vues</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./model.html">
 <span class="dropdown-text">Accès à la base de données</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./smarty.html">
 <span class="dropdown-text">Pages HTML</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./functions.html">
 <span class="dropdown-text">Fonctions et services</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./locale.html">
 <span class="dropdown-text">support des langues</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./command-line.html">
 <span class="dropdown-text">Ligne de commande</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./../en"> 
<span class="menu-text">English</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-autres-liens" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-globe" role="img">
</i> 
 <span class="menu-text">Autres liens</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-autres-liens">    
        <li>
    <a class="dropdown-item" href="https://quarto.org">
 <span class="dropdown-text">Quarto</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Sur cette page</h2>
   
  <ul>
  <li><a href="#gestion-des-accès-aux-données-stockées-en-base-de-données" id="toc-gestion-des-accès-aux-données-stockées-en-base-de-données" class="nav-link active" data-scroll-target="#gestion-des-accès-aux-données-stockées-en-base-de-données">Gestion des accès aux données stockées en base de données</a>
  <ul class="collapse">
  <li><a href="#initialiser-une-classe" id="toc-initialiser-une-classe" class="nav-link" data-scroll-target="#initialiser-une-classe">Initialiser une classe</a>
  <ul class="collapse">
  <li><a href="#description-des-champs" id="toc-description-des-champs" class="nav-link" data-scroll-target="#description-des-champs">Description des champs</a></li>
  <li><a href="#traitement-des-dates" id="toc-traitement-des-dates" class="nav-link" data-scroll-target="#traitement-des-dates">Traitement des dates</a></li>
  <li><a href="#traitement-des-champs-numériques" id="toc-traitement-des-champs-numériques" class="nav-link" data-scroll-target="#traitement-des-champs-numériques">Traitement des champs numériques</a></li>
  <li><a href="#enregistrement-des-messages-dinformations-traitement-des-erreurs" id="toc-enregistrement-des-messages-dinformations-traitement-des-erreurs" class="nav-link" data-scroll-target="#enregistrement-des-messages-dinformations-traitement-des-erreurs">Enregistrement des messages d’informations, traitement des erreurs</a></li>
  </ul></li>
  <li><a href="#fonctions-génériques-disponibles" id="toc-fonctions-génériques-disponibles" class="nav-link" data-scroll-target="#fonctions-génériques-disponibles">Fonctions génériques disponibles</a>
  <ul class="collapse">
  <li><a href="#exécution-des-requêtes" id="toc-exécution-des-requêtes" class="nav-link" data-scroll-target="#exécution-des-requêtes">Exécution des requêtes</a></li>
  <li><a href="#écriture-dun-enregistrement" id="toc-écriture-dun-enregistrement" class="nav-link" data-scroll-target="#écriture-dun-enregistrement">Écriture d’un enregistrement</a></li>
  <li><a href="#public-function-writearray-row-int" id="toc-public-function-writearray-row-int" class="nav-link" data-scroll-target="#public-function-writearray-row-int"><code>public function write(array $row): int</code></a></li>
  <li><a href="#écriture-dun-enregistrement-dans-une-table-n-n" id="toc-écriture-dun-enregistrement-dans-une-table-n-n" class="nav-link" data-scroll-target="#écriture-dun-enregistrement-dans-une-table-n-n">Écriture d’un enregistrement dans une table n-n</a></li>
  <li><a href="#mise-à-jour-dun-champ-binaire" id="toc-mise-à-jour-dun-champ-binaire" class="nav-link" data-scroll-target="#mise-à-jour-dun-champ-binaire">Mise à jour d’un champ binaire</a></li>
  <li><a href="#suppression-dun-enregistrement" id="toc-suppression-dun-enregistrement" class="nav-link" data-scroll-target="#suppression-dun-enregistrement">Suppression d’un enregistrement</a></li>
  <li><a href="#suppression-dun-ou-plusieurs-enregistrements-à-partir-dun-champ-quelconque" id="toc-suppression-dun-ou-plusieurs-enregistrements-à-partir-dun-champ-quelconque" class="nav-link" data-scroll-target="#suppression-dun-ou-plusieurs-enregistrements-à-partir-dun-champ-quelconque">Suppression d’un ou plusieurs enregistrements à partir d’un champ quelconque</a></li>
  <li><a href="#lecture-dun-enregistrement" id="toc-lecture-dun-enregistrement" class="nav-link" data-scroll-target="#lecture-dun-enregistrement">Lecture d’un enregistrement</a></li>
  <li><a href="#données-par-défaut" id="toc-données-par-défaut" class="nav-link" data-scroll-target="#données-par-défaut">Données par défaut</a></li>
  <li><a href="#lecture-dun-enregistrement-à-partir-dun-code-sql-fourni" id="toc-lecture-dun-enregistrement-à-partir-dun-code-sql-fourni" class="nav-link" data-scroll-target="#lecture-dun-enregistrement-à-partir-dun-code-sql-fourni">Lecture d’un enregistrement à partir d’un code SQL fourni</a></li>
  <li><a href="#liste-de-tous-les-enregistrements-de-la-table" id="toc-liste-de-tous-les-enregistrements-de-la-table" class="nav-link" data-scroll-target="#liste-de-tous-les-enregistrements-de-la-table">Liste de tous les enregistrements de la table</a></li>
  <li><a href="#sélection-denregistrements" id="toc-sélection-denregistrements" class="nav-link" data-scroll-target="#sélection-denregistrements">Sélection d’enregistrements</a></li>
  <li><a href="#liste-des-enregistrements-rattachés-à-un-parent" id="toc-liste-des-enregistrements-rattachés-à-un-parent" class="nav-link" data-scroll-target="#liste-des-enregistrements-rattachés-à-un-parent">Liste des enregistrements rattachés à un parent</a></li>
  </ul></li>
  <li><a href="#fonctions-diverses" id="toc-fonctions-diverses" class="nav-link" data-scroll-target="#fonctions-diverses">Fonctions diverses</a>
  <ul class="collapse">
  <li><a href="#formater-les-dates-au-format-de-la-base-de-données" id="toc-formater-les-dates-au-format-de-la-base-de-données" class="nav-link" data-scroll-target="#formater-les-dates-au-format-de-la-base-de-données">Formater les dates au format de la base de données</a></li>
  <li><a href="#générer-un-uuid" id="toc-générer-un-uuid" class="nav-link" data-scroll-target="#générer-un-uuid">Générer un UUID</a></li>
  <li><a href="#obtenir-la-date-heure-courante" id="toc-obtenir-la-date-heure-courante" class="nav-link" data-scroll-target="#obtenir-la-date-heure-courante">Obtenir la date-heure courante</a></li>
  <li><a href="#obtenir-la-date-courante" id="toc-obtenir-la-date-courante" class="nav-link" data-scroll-target="#obtenir-la-date-courante">Obtenir la date courante</a></li>
  <li><a href="#désactiver-un-champ-obligatoire" id="toc-désactiver-un-champ-obligatoire" class="nav-link" data-scroll-target="#désactiver-un-champ-obligatoire">Désactiver un champ obligatoire</a></li>
  </ul></li>
  <li><a href="#gestion-de-la-connexion-à-une-autre-base-de-données" id="toc-gestion-de-la-connexion-à-une-autre-base-de-données" class="nav-link" data-scroll-target="#gestion-de-la-connexion-à-une-autre-base-de-données">Gestion de la connexion à une autre base de données</a></li>
  </ul></li>
  </ul>
</nav>
    <div class="quarto-margin-footer"><div class="margin-footer-item">
<p>Made with <a href="https://github.com/SebastienBoutry/inrae-project-website"><img src="https://github.com/SebastienBoutry/inrae-project-website/blob/main/images/extension-logo.png?raw=true" class="img-fluid" width="50"></a></p>
</div></div></div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header>




<section id="gestion-des-accès-aux-données-stockées-en-base-de-données" class="level1">
<h1>Gestion des accès aux données stockées en base de données</h1>
<p>Les classes permettant le dialogue avec la base de données sont stockées dans <code>app/Models</code>. Elles héritent toutes de la classe <code>PpciModel</code>, qui encapsule l’ensemble des fonctions d’accès et de mise à jour.</p>
<p>PpciModel s’appuie autant que faire se peut sur les mécanismes intrinsèques de CodeIgniter. Toutefois, certaines fonctions d’écriture ont été réécrites pour mieux maîtriser les opérations réalisées dans la base de données.</p>
<section id="initialiser-une-classe" class="level2">
<h2 class="anchored" data-anchor-id="initialiser-une-classe">Initialiser une classe</h2>
<p>Lors de l’initialisation d’une classe d’accès à une table, plusieurs paramètres sont à renseigner :</p>
<ul>
<li>le nom de la table</li>
<li>la liste des colonnes avec, pour chacune, si elle doit être fournie (obligatoire), son type, s’il s’agit de la clé primaire de la table, la valeur par défaut en cas de création d’un nouvel enregistrement, et si l’attribut est une clé étrangère vers le parent de l’enregistrement courant</li>
<li>si la clé primaire est générée automatiquement ou pas par la base de données.</li>
</ul>
<p>Exemple :</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode php code-with-copy"><code class="sourceCode php"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> App\Models<span class="ot">;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> Ppci\Models\PpciModel<span class="ot">;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Peche <span class="kw">extends</span> PpciModel</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">array</span> <span class="va">$warning</span> <span class="op">=</span> <span class="dt">array</span>()<span class="ot">;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">function</span> <span class="bu">__construct</span>()</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">$this</span>-&gt;table <span class="op">=</span> <span class="st">"peche"</span><span class="ot">;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">$this</span>-&gt;fields <span class="op">=</span> <span class="dt">array</span>(</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">"peche_id"</span> =&gt; <span class="dt">array</span>(</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>                <span class="st">"type"</span> =&gt; <span class="dv">1</span><span class="ot">,</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>                <span class="st">"key"</span> =&gt; <span class="dv">1</span><span class="ot">,</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>                <span class="st">"requis"</span> =&gt; <span class="dv">1</span><span class="ot">,</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>                <span class="st">"defaultValue"</span> =&gt; <span class="dv">0</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>            )<span class="ot">,</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">"trait_id"</span> =&gt; <span class="dt">array</span>(</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>                <span class="st">"type"</span> =&gt; <span class="dv">1</span><span class="ot">,</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>                <span class="st">"requis"</span> =&gt; <span class="dv">1</span><span class="ot">,</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>                <span class="st">"parentAttrib"</span> =&gt; <span class="dv">1</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>            )<span class="ot">,</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>            <span class="st">"uuid"</span> =&gt; <span class="dt">array</span>(</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>                <span class="st">"type"</span> =&gt; <span class="dv">0</span><span class="ot">,</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>                <span class="st">"defaultValue"</span> =&gt; <span class="va">$this</span>-&gt;getUUID()</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>            )<span class="ot">,</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>        )<span class="ot">;</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>        <span class="kw">parent</span>::<span class="bu">__construct</span>()<span class="ot">;</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
<section id="description-des-champs" class="level3">
<h3 class="anchored" data-anchor-id="description-des-champs">Description des champs</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Attribut</th>
<th>Valeur</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>type</td>
<td>0 : chaîne de caractères 1: numérique 2: date 3: date-heure 4: champ géographique (Postgis)</td>
</tr>
<tr class="even">
<td>key</td>
<td>Si 1, c’est la clé primaire de la table</td>
</tr>
<tr class="odd">
<td>requis</td>
<td>Si 1, l’enregistrement échouera si la colonne n’est pas fournie ou est vide</td>
</tr>
<tr class="even">
<td>parentAttrib</td>
<td>Si 1, la colonne est la clé étrangère, dans le cas d’une relation père-fils</td>
</tr>
<tr class="odd">
<td>defaultValue</td>
<td>La valeur par défaut, lors de la création d’un enregistrement.</td>
</tr>
</tbody>
</table>
<p>Par convention, pour tout nouvel enregistrement, la clé primaire prend la valeur 0.</p>
</section>
<section id="traitement-des-dates" class="level3">
<h3 class="anchored" data-anchor-id="traitement-des-dates">Traitement des dates</h3>
<p>Les dates sont automatiquement transformées dans le format courant de la langue utilisée, tant pour les sélections que pour les mises à jour. Lors de l’initialisation de la classe, les tableaux &nbsp;<code>$this-&gt;dateFields</code> et <code>$this-&gt;datetimeFields</code> sont renseignés à partir des informations déclarées. Il est possible de les compléter ponctuellement avant d’exécuter un <code>select</code> pour que des champs dates externes à la table, dans le cadre de jointures, soient également formatés.</p>
<p>S’il est nécessaire de désactiver le formatage des date, il suffit d’indiquer :</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode php code-with-copy"><code class="sourceCode php"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="va">$this</span>-&gt;autoformatDate <span class="op">=</span> <span class="kw">false</span><span class="ot">;</span></span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="traitement-des-champs-numériques" class="level3">
<h3 class="anchored" data-anchor-id="traitement-des-champs-numériques">Traitement des champs numériques</h3>
<p>Par défaut, avant une mise à jour, les nombres sont traités pour remplacer la virgule par le point. Si ce mécanisme doit être désactivé, il suffit d’indiquer :</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode php code-with-copy"><code class="sourceCode php"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="va">$this</span>-&gt;transformComma <span class="op">=</span> <span class="kw">false</span><span class="ot">;</span></span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="enregistrement-des-messages-dinformations-traitement-des-erreurs" class="level3">
<h3 class="anchored" data-anchor-id="enregistrement-des-messages-dinformations-traitement-des-erreurs">Enregistrement des messages d’informations, traitement des erreurs</h3>
<p>La classe intègre nativement la classe <code>Message</code>, qui permet d’envoyer des informations au navigateur ou d’enregistrer des messages d’erreur dans les logs du serveur (syslog). Elle est accessible <em>via</em> <code>$this-&gt;message-&gt;set(...);</code></p>
<p>Les erreurs d’exécution déclenchent une exception <code>PpciException</code>.</p>
</section>
</section>
<section id="fonctions-génériques-disponibles" class="level2">
<h2 class="anchored" data-anchor-id="fonctions-génériques-disponibles">Fonctions génériques disponibles</h2>
<section id="exécution-des-requêtes" class="level3">
<h3 class="anchored" data-anchor-id="exécution-des-requêtes">Exécution des requêtes</h3>
<p><code>protected function executeQuery(string $sql, array $data = null, $onlyExecute = false)</code></p>
<p>Synonyme : <code>public function executeSQL(string $sql, array $data = null, $onlyExecute = false)</code></p>
<p>Exécute la requête $sql, avec le tableau de variables <span class="math inline">\(data. Si `\)</span>onlyExecute` est à <em>false</em>, la fonction retourne un tableau de résultat. Les requêtes de modification doivent impérativement avoir cette dernière variable à <em>true</em>.</p>
</section>
<section id="écriture-dun-enregistrement" class="level3">
<h3 class="anchored" data-anchor-id="écriture-dun-enregistrement">Écriture d’un enregistrement</h3>
</section>
<section id="public-function-writearray-row-int" class="level3">
<h3 class="anchored" data-anchor-id="public-function-writearray-row-int"><code>public function write(array $row): int</code></h3>
<p>Synonyme : <code>public function ecrire(array $row): int</code></p>
<p>Enregistre une ligne ($row) dans la base de données. La fonction gère automatiquement l’insertion ou la mise à jour.</p>
<p>Pour les champs géographiques, ceux-ci sont enregistrés avec la fonction <code>ST_GeomFromText</code>.</p>
<p>Retour : la clé primaire de l’enregistrement traité.</p>
</section>
<section id="écriture-dun-enregistrement-dans-une-table-n-n" class="level3">
<h3 class="anchored" data-anchor-id="écriture-dun-enregistrement-dans-une-table-n-n">Écriture d’un enregistrement dans une table n-n</h3>
<p><code>function writeTableNN(string $tablename, string $firstKey, string $secondKey, int $id, $data = array()): void</code></p>
<p>Synonyme : <code>function ecrireTableNN(string $tablename, string $firstKey, string $secondKey, int $id, $data = array()): void</code></p>
<p>Cette fonction traite le cas de l’enregistrement dans le cas d’une table n-n, c’est à dire liée à deux parents. Elle est typiquement utilisée pour traiter les valeurs multiples (sélection des membres dans un groupe, par exemple).</p>
<p>Elle va enregistrer dans <code>$tablename</code>, pour la clé correspondant au parent principal (<code>$firstKey</code>), l’ensemble des valeurs correspondant à la table liée (<code>$secondKey</code>), fournies sous forme de tableau (<code>$data</code>). La fonction va supprimer automatiquement toutes les valeurs pré-existantes qui ne figurent pas dans le tableau fourni.</p>
</section>
<section id="mise-à-jour-dun-champ-binaire" class="level3">
<h3 class="anchored" data-anchor-id="mise-à-jour-dun-champ-binaire">Mise à jour d’un champ binaire</h3>
<p><code>function updateBinary(int $id, string $fieldName, $data)</code></p>
<p>La fonction va écrire un contenu binaire dans la colonne <code>$fieldName</code> pour l’enregistrement identifié par la clé primaire <code>$id</code>. Dans la pratique, elle utilise la fonction php <em>pg_escape_bytea</em>.</p>
</section>
<section id="suppression-dun-enregistrement" class="level3">
<h3 class="anchored" data-anchor-id="suppression-dun-enregistrement">Suppression d’un enregistrement</h3>
<p><code>function delete($id = null, bool $purge = false)</code></p>
<p>Synonyme : <code>function supprimer($id)</code></p>
<p>Supprime l’enregistrement <code>$id</code>. La valeur <code>$purge</code> ne sert à rien, elle est conservée pour des raisons de compatibilité avec les classes CodeIgniter.</p>
</section>
<section id="suppression-dun-ou-plusieurs-enregistrements-à-partir-dun-champ-quelconque" class="level3">
<h3 class="anchored" data-anchor-id="suppression-dun-ou-plusieurs-enregistrements-à-partir-dun-champ-quelconque">Suppression d’un ou plusieurs enregistrements à partir d’un champ quelconque</h3>
<p><code>function deleteFromField(int $id, string $field)</code></p>
<p>Synonyme : <code>function supprimerChamp(int $id, string $field)</code></p>
<p>Cette fonction est utilisée pour supprimer les enregistrements enfants à partir d’un parent. Elle supprime tous les enregistrements dont le champ <code>$field</code> qui contient la valeur <code>$id</code>.</p>
</section>
<section id="lecture-dun-enregistrement" class="level3">
<h3 class="anchored" data-anchor-id="lecture-dun-enregistrement">Lecture d’un enregistrement</h3>
<p><code>public function read(int $id, bool $getDefault = true, $parentKey = 0): array</code></p>
<p>Synonyme : <code>public function lire(int $id, bool $getDefault = true, $parentKey = 0): array</code></p>
<p>Llt l’enregistrement dont la clé primaire vaut <code>$id</code>. Si <code>$id</code> vaut 0 ou est vide (nouvel enregistrement), et que <code>$getDefault</code> est positionné à <em>true</em>, le tableau retourné contiendra les valeurs par défaut définies dans le constructeur de la classe. Si <code>$parentKey</code> est défini, la clé étrangère du parent est également positionnée dans les valeurs par défaut.</p>
</section>
<section id="données-par-défaut" class="level3">
<h3 class="anchored" data-anchor-id="données-par-défaut">Données par défaut</h3>
<p><code>public function getDefaultValues($parentKey = 0): array</code></p>
<p>Crée un tableau contenant l’ensemble des valeurs par défaut, pour un nouvel enregistrement.&nbsp;</p>
</section>
<section id="lecture-dun-enregistrement-à-partir-dun-code-sql-fourni" class="level3">
<h3 class="anchored" data-anchor-id="lecture-dun-enregistrement-à-partir-dun-code-sql-fourni">Lecture d’un enregistrement à partir d’un code SQL fourni</h3>
<p><code>public function readParam(string $sql, array $param = null)</code></p>
<p>Synonymes :&nbsp;</p>
<p><code>public function readParamAsPrepared(string $sql, array $param = null)</code></p>
<p><code>public function lireParam(string $sql, array $param = null)</code></p>
<p><code>public function lireParamAsPrepared(string $sql, array $param = null)</code></p>
<p>Retourne un enregistrement correspondant au code SQL fourni (le premier enregistrement rencontré si une liste est retournée par la requête). Les variables utilisées dans la requête doivent être fournies dans le tableau <em>$param</em>.</p>
</section>
<section id="liste-de-tous-les-enregistrements-de-la-table" class="level3">
<h3 class="anchored" data-anchor-id="liste-de-tous-les-enregistrements-de-la-table">Liste de tous les enregistrements de la table</h3>
<p><code>public function getList(string $order = ""): array</code></p>
<p>Synonyme : <code>function getListe(string $order = ""): array</code></p>
<p>Exécute un <code>select *</code> sur la table, en rajoutant le cas échéant le terme <code>order by $order</code> si la variable est renseignée.</p>
</section>
<section id="sélection-denregistrements" class="level3">
<h3 class="anchored" data-anchor-id="sélection-denregistrements">Sélection d’enregistrements</h3>
<p><code>function getListParam(string $sql, array $param = null): array</code></p>
<p>Synonymes :</p>
<p><code>function getListeParam(string $sql, array $param = null): array</code></p>
<p><code>function getListeParamAsPrepared(string $sql, array $param = null): array</code></p>
<p>Retourne le résultat de la requête. Les variables utilisées pour celle-ci sont fournies dans le tableau <em>$param</em>.</p>
</section>
<section id="liste-des-enregistrements-rattachés-à-un-parent" class="level3">
<h3 class="anchored" data-anchor-id="liste-des-enregistrements-rattachés-à-un-parent">Liste des enregistrements rattachés à un parent</h3>
<p><code>function getListFromParent(int $parentId, $order = ""): array</code></p>
<p>Retourne la liste des enregistrements enfants dont la clé étrangère vaut <em>$parentId</em>, triée ou non.</p>
</section>
</section>
<section id="fonctions-diverses" class="level2">
<h2 class="anchored" data-anchor-id="fonctions-diverses">Fonctions diverses</h2>
<section id="formater-les-dates-au-format-de-la-base-de-données" class="level3">
<h3 class="anchored" data-anchor-id="formater-les-dates-au-format-de-la-base-de-données">Formater les dates au format de la base de données</h3>
<p><code>protected function formatDatesToDB(array $row): array</code></p>
<p>Transforme les dates contenues dans l’enregistrement, en fonction du type (date, date/heure) et du format courant.</p>
</section>
<section id="générer-un-uuid" class="level3">
<h3 class="anchored" data-anchor-id="générer-un-uuid">Générer un UUID</h3>
<p><code>function getUUID(): string</code></p>
<p>Execute une fonction dans la base de données pour générer un UUID.</p>
</section>
<section id="obtenir-la-date-heure-courante" class="level3">
<h3 class="anchored" data-anchor-id="obtenir-la-date-heure-courante">Obtenir la date-heure courante</h3>
<p><code>function getDateTime(): string</code></p>
<p><code>function getDateHeure(): string</code></p>
</section>
<section id="obtenir-la-date-courante" class="level3">
<h3 class="anchored" data-anchor-id="obtenir-la-date-courante">Obtenir la date courante</h3>
<p><code>function getDate(): string</code></p>
<p><code>function getDateJour(): string</code></p>
</section>
<section id="désactiver-un-champ-obligatoire" class="level3">
<h3 class="anchored" data-anchor-id="désactiver-un-champ-obligatoire">Désactiver un champ obligatoire</h3>
<p><code>function disableMandatoryField(string $name)</code></p>
<p>Désactive la valeur <em>champ obligatoire</em> pour un champ. Cette fonction peut être utilisée pour mettre à jour un enregistrement dont on sait par avance que la valeur n’est pas fournie.</p>
</section>
</section>
<section id="gestion-de-la-connexion-à-une-autre-base-de-données" class="level2">
<h2 class="anchored" data-anchor-id="gestion-de-la-connexion-à-une-autre-base-de-données">Gestion de la connexion à une autre base de données</h2>
<p>Déclarer la base de données dans le fichier `app/Config/Database.php’ :</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>    <span class="ex">public</span> array <span class="va">$cinna</span> = [</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>        <span class="st">'DSN'</span>          =<span class="op">&gt;</span> <span class="st">''</span>,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">'hostname'</span>     =<span class="op">&gt;</span> <span class="st">'localhost'</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">'username'</span>     =<span class="op">&gt;</span> <span class="st">''</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">'password'</span>     =<span class="op">&gt;</span> <span class="st">''</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">'database'</span>     =<span class="op">&gt;</span> <span class="st">'estuaire_phy'</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">'DBDriver'</span>     =<span class="op">&gt;</span> <span class="st">'Postgre'</span>,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">'DBPrefix'</span>     =<span class="op">&gt;</span> <span class="st">''</span>,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'pConnect'</span>     =<span class="op">&gt;</span> false,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'DBDebug'</span>      =<span class="op">&gt;</span> true,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">'charset'</span>      =<span class="op">&gt;</span> <span class="st">'utf8'</span>,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">'DBCollat'</span>     =<span class="op">&gt;</span> <span class="st">'utf8_general_ci'</span>,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">'swapPre'</span>      =<span class="op">&gt;</span> <span class="st">''</span>,</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">'encrypt'</span>      =<span class="op">&gt;</span> false,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">'compress'</span>     =<span class="op">&gt;</span> false,</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">'strictOn'</span>     =<span class="op">&gt;</span> false,</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">'failover'</span>     =<span class="op">&gt;</span> [],</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">'port'</span>         =<span class="op">&gt;</span> 5432,</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">'numberNative'</span> =<span class="op">&gt;</span> false,</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">"searchpath"</span>   =<span class="op">&gt;</span> <span class="st">"cinna,public"</span>,</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    <span class="ex">]</span><span class="kw">;</span></span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
<p>Adapter les paramètres de connexion dans le fichier <code>.env</code> à la racine de l’application.</p>
<p>Pour déclencher la connexion à la base de données, par exemple depuis une librairie :</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode php code-with-copy"><code class="sourceCode php"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">* </span><span class="an">@var</span><span class="co"> </span><span class="do">\CodeIgniter\Database\BaseConnection</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="va">$db</span> <span class="op">=</span> \Config\Database::connect(<span class="st">"cinna"</span><span class="ot">,</span> <span class="kw">true</span>)<span class="ot">;</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="va">$db</span>) {</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="va">$db</span>-&gt;query(<span class="st">"set search_path = "</span> <span class="op">.</span> <span class="va">$_ENV</span>[<span class="st">"database.cinna.searchpath"</span>])<span class="ot">;</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="va">$this</span>-&gt;message-&gt;set(<span class="fu">_</span>(<span class="st">"Connexion à la base utilisée pour enregistrer les paramètres CINNA impossible"</span>)<span class="ot">,</span> <span class="kw">true</span>)<span class="ot">;</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    defaultPage()<span class="ot">;</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
<p>Pour rattacher un modèle à cette connexion, il faut déclarer la variable $DBGroup en lui assignant le nom de la connexion :</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode php code-with-copy"><code class="sourceCode php"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Cinna <span class="kw">extends</span> PpciModel</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">protected</span> <span class="va">$DBGroup</span> <span class="op">=</span> <span class="st">'cinna'</span><span class="ot">;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="bu">__construct</span>()</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">$this</span>-&gt;table <span class="op">=</span> <span class="st">"cinna"</span><span class="ot">;</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    (...)</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
<p>CodeIgniter gérera alors correctement la connexion.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copié");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copié");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>